{#
Open in Reader App Dropdown Component

Allows users to open content in their preferred reader app for listening:
- ElevenReader (AI voice narration)
- Pocket (save & listen later)
- Instapaper (clean reading)
- Share/Copy link (for any other app)

URLs and title are passed via data attributes (no inline user content in handlers).

Usage:
  {{ listen_with(reader_url='/brief/2025-01-29/reader', brief_title='Brief') }}

Parameters:
  - reader_url: String - URL to the reader-optimized version of the page
  - brief_title: String - title for sharing
#}

{% macro listen_with(has_audio=False, audio_url=None, reader_url=None, brief_title='Brief') %}
<div class="listen-with-container relative"
     data-reader-url="{{ (reader_url or request.url)|e }}"
     data-brief-title="{{ brief_title|e }}">

    <button type="button"
            aria-haspopup="true"
            aria-expanded="false"
            class="inline-flex items-center gap-2 px-4 py-2.5 min-h-[44px] sm:min-h-0 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors touch-manipulation">
        <svg class="w-5 h-5 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
        </svg>
        <span>Open in reader app</span>
        <svg class="w-4 h-4 text-gray-400 listen-chevron transition-transform flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
    </button>

    <!-- Dropdown Menu -->
    <div class="listen-menu hidden absolute left-0 z-50 mt-2 w-72 max-w-[calc(100vw-2rem)] origin-top-left rounded-xl bg-white shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"
         role="menu">
        <div class="p-2">
            <!-- ElevenReader -->
            <button type="button"
                    data-action="elevenreader"
                    class="listen-menu-item flex items-center gap-3 w-full px-3 py-2.5 min-h-[44px] sm:min-h-0 text-left text-sm text-gray-700 rounded-lg hover:bg-gray-50 transition-colors touch-manipulation"
                    role="menuitem">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex-shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
                    </svg>
                </span>
                <div class="min-w-0">
                    <p class="font-medium">ElevenReader</p>
                    <p class="text-xs text-gray-500">AI voice narration</p>
                </div>
            </button>

            <!-- Instapaper -->
            <button type="button"
                    data-action="instapaper"
                    class="listen-menu-item flex items-center gap-3 w-full px-3 py-2.5 min-h-[44px] sm:min-h-0 text-left text-sm text-gray-700 rounded-lg hover:bg-gray-50 transition-colors touch-manipulation"
                    role="menuitem">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-gray-800 text-white flex-shrink-0">
                    <span class="text-xs font-bold">Ip</span>
                </span>
                <div class="min-w-0">
                    <p class="font-medium">Instapaper</p>
                    <p class="text-xs text-gray-500">Clean reading experience</p>
                </div>
            </button>

            <!-- Share / Copy Link -->
            <button type="button"
                    data-action="native"
                    class="listen-menu-item flex items-center gap-3 w-full px-3 py-2.5 min-h-[44px] sm:min-h-0 text-left text-sm text-gray-700 rounded-lg hover:bg-gray-50 transition-colors touch-manipulation"
                    role="menuitem">
                <span class="flex items-center justify-center w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex-shrink-0">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                </span>
                <div class="min-w-0">
                    <p class="font-medium">Share / Copy Link</p>
                    <p class="text-xs text-gray-500">Open in any reader app</p>
                </div>
            </button>
        </div>
    </div>
</div>
{% endmacro %}
