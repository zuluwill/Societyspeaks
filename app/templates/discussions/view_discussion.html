{% extends "layout.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <!-- Discussion Header and Share Button Section -->
    <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
        <div class="max-w-3xl mx-auto">
            <div class="flex flex-wrap items-start justify-between gap-4">
                <h1 class="text-3xl font-bold text-gray-900">{{ discussion.title }}</h1>

                <!-- Share Button with Dropdown -->
                <div class="relative">
                    <button type="button" id="shareButton" aria-haspopup="true" aria-expanded="false" aria-label="Share Discussion"
                            class="inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                        <svg class="h-5 w-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
                        </svg>
                        Share Discussion
                    </button>
                    <!-- Share Dropdown Menu -->
                    <div id="shareButtons" class="hidden absolute top-full mt-2 right-0 w-56 rounded-md bg-white shadow-lg ring-1 ring-black ring-opacity-5 z-50">
                        <div class="py-1">
                            {% set share_title = discussion.title|urlencode %}
                            {% set share_url = url_for('discussions.view_discussion', discussion_id=discussion.id, slug=discussion.slug, _external=True) %}
                            {% set share_text = "Join this important discussion on SocietySpeaks: " + discussion.title %}

                            <!-- LinkedIn -->
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url={{ share_url }}&title={{ share_title }}" target="_blank" class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                 <img src="{{ url_for('static', filename='icons/Linkedin_icon.svg') }}" alt="LinkedIn" class="h-5 w-5 mr-3">
                                LinkedIn
                            </a>
                            <!-- Meta (Facebook) -->
                            <a href="https://www.facebook.com/sharer/sharer.php?u={{ share_url }}&quote={{ share_text|urlencode }}"
                                target="_blank"
                                class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{{ url_for('static', filename='icons/facebook.svg') }}" alt="Facebook" class="h-5 w-5 mr-3">
                                Meta (Facebook)
                            </a>

                            <!-- X (Twitter) -->
                            <a href="https://twitter.com/intent/tweet?text={{ share_text|urlencode }}&url={{ share_url }}"
                                target="_blank"
                                class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{{ url_for('static', filename='icons/X_icon.svg') }}" alt="X (Twitter)" class="h-5 w-5 mr-3">
                                X (Twitter)
                            </a>

                            <!-- BlueSky -->
                            <a href="https://bsky.app/intent/compose?text={{ share_text|urlencode }} {{ share_url }}"
                                target="_blank"
                                class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{{ url_for('static', filename='icons/bluesky.svg') }}" alt="Bluesky" class="h-5 w-5 mr-3">
                                BlueSky
                            </a>

                            <!-- WhatsApp -->
                            <a href="https://wa.me/?text={{ share_text|urlencode }}%20{{ share_url }}"
                                target="_blank"
                                class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{{ url_for('static', filename='icons/whatsapp.svg') }}" alt="WhatsApp" class="h-5 w-5 mr-3">
                                WhatsApp
                            </a>

                            <!-- Telegram -->
                            <a href="https://t.me/share/url?url={{ share_url }}&text={{ share_text|urlencode }}"
                                target="_blank"
                                class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <img src="{{ url_for('static', filename='icons/telegram.svg') }}" alt="Telegram" class="h-5 w-5 mr-3">
                                Telegram
                            </a>

                            <!-- Email -->
                            <a href="mailto:?subject={{ share_title }}%20-%20SocietySpeaks%20Discussion&body={{ share_text|urlencode }}%0A%0A{{ share_url }}"
                                class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg class="h-5 w-5 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                                </svg>
                                Email
                            </a>

                            <!-- Copy Link -->
                            <button onclick="copyLink('{{ url_for('discussions.view_discussion', discussion_id=discussion.id, slug=discussion.slug, _external=True) }}')"
                                    class="flex w-full items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                                <svg class="h-5 w-5 mr-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"/>
                                </svg>
                                <span class="copy-text">Copy Link</span>
                            </button>
                        </div>
                    </div>
                </div>
                    
            <!-- Discussion Details -->

                <div class="flex flex-wrap gap-4 text-sm text-gray-500">
                    {% if discussion.topic %}
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
                            </svg>
                            {{ discussion.topic }}
                        </div>
                    {% endif %}

                    {% if discussion.city or discussion.country %}
                        <div class="flex items-center">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                            {{ [discussion.city, discussion.country]|select('boolean')|join(', ') }}
                        </div>
                    {% endif %}

                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Started {{ discussion.created_at.strftime('%B %d, %Y') }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Adjusted Pol.is Discussion Embed without outer container -->
    <div class="min-h-screen">
        {% if discussion.embed_code %}
            <!-- Render the embed code directly from the database -->
            {{ discussion.embed_code | safe }}
        {% else %}
            <!-- Fallback message if no embed code is available -->
            <div class="text-center p-6">
                <p class="text-gray-600">The discussion embed is not available. <a href="{{ polis_url }}" target="_blank" class="text-blue-600 hover:underline">Click here</a> to open it in a new tab.</p>
            </div>
        {% endif %}
    </div>



<script>
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(() => {
            const toast = document.createElement('div');
            toast.textContent = 'Link copied to clipboard!';
            toast.className = 'fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg';
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }).catch(err => {
            console.error('Failed to copy text: ', err);
        });
    }


    document.addEventListener('DOMContentLoaded', function() {
        const shareButton = document.getElementById('shareButton');
        const shareButtons = document.querySelector('#shareButtons');

        shareButton.addEventListener('click', function(e) {
            e.stopPropagation();
            shareButtons.classList.toggle('hidden');
        });

        // Close share buttons when clicking outside
        document.addEventListener('click', function(e) {
            if (!shareButtons.contains(e.target) && !shareButton.contains(e.target)) {
                shareButtons.classList.add('hidden');
            }
        });
    });

    async function copyLink(url) {
        try {
            await navigator.clipboard.writeText(url);
            const button = event.currentTarget;
            const textSpan = button.querySelector('.copy-text');
            if (textSpan) {
                const originalText = textSpan.textContent;
                textSpan.textContent = 'Copied!';
                setTimeout(() => textSpan.textContent = originalText, 2000);
            }
        } catch (err) {
            console.error('Failed to copy text: ', err);
        }
    }
    
  
    
  
    
</script>
{% endblock %}