{% extends 'layout.html' %}

{% block title %}Manage News Sources - Trending Topics{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 py-8">
    <div class="mb-6">
        <a href="{{ url_for('trending.dashboard') }}" class="text-blue-600 hover:underline">&larr; Back to Dashboard</a>
    </div>

    <h1 class="text-3xl font-bold text-gray-900 mb-8">Manage News Sources</h1>

    <div class="bg-white rounded-lg shadow mb-8">
        <div class="p-4 border-b">
            <h2 class="text-xl font-semibold">Add New Source</h2>
        </div>
        <form action="{{ url_for('trending.add_source') }}" method="post" class="p-4">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Source Name</label>
                    <input type="text" name="name" required placeholder="e.g., Financial Times"
                        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Source Type</label>
                    <select name="source_type" class="w-full border border-gray-300 rounded-lg px-3 py-2">
                        <option value="rss">RSS Feed</option>
                        <option value="guardian">Guardian API</option>
                    </select>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Feed URL / API Endpoint</label>
                    <input type="url" name="feed_url" required placeholder="https://..."
                        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Reputation Score (0-1)</label>
                    <input type="number" name="reputation_score" min="0" max="1" step="0.05" value="0.7"
                        class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
            </div>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                Add Source
            </button>
        </form>
    </div>

    <div class="bg-white rounded-lg shadow">
        <div class="p-4 border-b">
            <h2 class="text-xl font-semibold">Current Sources</h2>
        </div>
        <div class="divide-y">
            {% for source in sources %}
            <div class="p-4 flex justify-between items-center">
                <div>
                    <div class="font-medium text-gray-900">{{ source.name }}</div>
                    <div class="text-sm text-gray-500">
                        {{ source.source_type }} | Reputation: {{ "%.0f"|format(source.reputation_score * 100) }}%
                    </div>
                    <div class="text-xs text-gray-400 mt-1">
                        {% if source.last_fetched_at %}
                            Last fetched: {{ source.last_fetched_at.strftime('%Y-%m-%d %H:%M') }}
                        {% else %}
                            Never fetched
                        {% endif %}
                        {% if source.fetch_error_count > 0 %}
                        | <span class="text-red-500">{{ source.fetch_error_count }} errors</span>
                        {% endif %}
                    </div>
                </div>
                <div class="flex gap-2">
                    <form action="{{ url_for('trending.toggle_source', source_id=source.id) }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="px-3 py-1 rounded text-sm
                            {% if source.is_active %}bg-yellow-100 text-yellow-800 hover:bg-yellow-200
                            {% else %}bg-green-100 text-green-800 hover:bg-green-200{% endif %}">
                            {% if source.is_active %}Disable{% else %}Enable{% endif %}
                        </button>
                    </form>
                    <form action="{{ url_for('trending.delete_source', source_id=source.id) }}" method="post">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <button type="submit" class="px-3 py-1 rounded text-sm bg-red-100 text-red-800 hover:bg-red-200"
                            onclick="return confirm('Delete this source?')">
                            Delete
                        </button>
                    </form>
                </div>
            </div>
            {% else %}
            <div class="p-4 text-gray-500 text-center">
                No sources configured. Add your first source above.
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
