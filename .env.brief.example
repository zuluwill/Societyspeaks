# ======================================================================================
# DAILY BRIEF SYSTEM - ENVIRONMENT VARIABLES
# ======================================================================================
# Add these to your existing .env file

# --------------------------------------------------------------------------------------
# REQUIRED - Email Delivery
# --------------------------------------------------------------------------------------

# Resend API Key - Get from https://resend.com/api-keys
RESEND_API_KEY=re_...

# From email address (must be verified domain in Resend)
BRIEF_FROM_EMAIL=Daily Brief <brief@societyspeaks.com>

# --------------------------------------------------------------------------------------
# REQUIRED - LLM (you should already have one of these)
# --------------------------------------------------------------------------------------

# OpenAI API Key (for brief generation)
OPENAI_API_KEY=sk-...

# OR Anthropic API Key (alternative to OpenAI)
# ANTHROPIC_API_KEY=sk-ant-...

# --------------------------------------------------------------------------------------
# OPTIONAL - Billing & Subscriptions
# --------------------------------------------------------------------------------------

# Billing enforcement (set to 'true' when ready to charge subscribers)
# During testing, keep as 'false' - everyone gets full access
BILLING_ENFORCEMENT_ENABLED=false

# Stripe Secret Key (test mode for development)
STRIPE_SECRET_KEY=sk_test_...

# Stripe Webhook Secret (for payment event handling)
STRIPE_WEBHOOK_SECRET=whsec_...

# Stripe Price IDs (create these in Stripe Dashboard)
STRIPE_BRIEF_INDIVIDUAL_MONTHLY=price_...    # $6/month
STRIPE_BRIEF_INDIVIDUAL_YEARLY=price_...     # $60/year
STRIPE_BRIEF_TEAM_MONTHLY=price_...          # $40/month for 5 seats

# --------------------------------------------------------------------------------------
# OPTIONAL - Customization
# --------------------------------------------------------------------------------------

# Admin review window in minutes (default: 60)
# Time between brief generation (5pm) and auto-publish (6pm)
BRIEF_ADMIN_REVIEW_WINDOW=60

# Minimum topics for daily brief (default: 3)
BRIEF_MIN_ITEMS=3

# Maximum topics for daily brief (default: 5)
BRIEF_MAX_ITEMS=5

# Minimum civic score for topic inclusion (default: 0.6)
BRIEF_MIN_CIVIC_SCORE=0.6

# --------------------------------------------------------------------------------------
# OPTIONAL - Notifications (future feature)
# --------------------------------------------------------------------------------------

# Slack webhook for admin notifications (brief ready for review)
# SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...

# Critical ops alert recipient for scheduler failures (defaults to will@societyspeaks.io)
OPS_ALERT_EMAIL_TO=will@societyspeaks.io

# Suppress duplicate ops alerts for the same error within this window (seconds)
OPS_ALERT_COOLDOWN_SECONDS=900

# --------------------------------------------------------------------------------------
# EXISTING VARIABLES (you should have these already)
# --------------------------------------------------------------------------------------

# Database
# DATABASE_URL=postgresql://...

# Redis (for sessions)
# REDIS_URL=redis://...

# Loops.so (for daily question emails)
# LOOPS_API_KEY=...

# Guardian API (for news fetching)
# GUARDIAN_API_KEY=...

# ======================================================================================
# SETUP CHECKLIST
# ======================================================================================

# 1. Copy relevant variables to your .env file
# 2. Get Resend API key: https://resend.com/api-keys
# 3. Verify your sending domain in Resend (or use their sandbox)
# 4. Set BILLING_ENFORCEMENT_ENABLED=false for testing
# 5. Run: flask db upgrade
# 6. Run: flask seed-allsides
# 7. Test: flask generate-brief
# 8. Test: flask test-brief-email your.email@example.com
# 9. Check scheduler running: flask shell -> from app.scheduler import scheduler; scheduler.get_jobs()
# 10. Monitor logs: tail -f logs/*.log

# ======================================================================================
# RESEND SETUP GUIDE
# ======================================================================================

# 1. Sign up at https://resend.com (free tier: 100 emails/day, 3,000/month)
# 2. Add and verify your domain:
#    - Go to Domains → Add Domain
#    - Add DNS records (SPF, DKIM, DMARC)
#    - Verify domain (usually takes 15-30 minutes)
# 3. Create API key:
#    - Go to API Keys → Create API Key
#    - Name it "Daily Brief Production" or "Daily Brief Test"
#    - Copy the key (starts with "re_")
#    - Add to .env as RESEND_API_KEY
# 4. Set from address:
#    - Use your verified domain: brief@yourdomain.com
#    - Or use Resend sandbox for testing: onboarding@resend.dev

# ======================================================================================
# STRIPE SETUP GUIDE (for paid subscriptions)
# ======================================================================================

# 1. Sign up at https://dashboard.stripe.com
# 2. Enable test mode (toggle in top right)
# 3. Create Products:
#    - Name: "Daily Brief - Individual Monthly"
#    - Price: $6.00 USD
#    - Billing: Recurring, Monthly
#    - Copy Price ID (price_...)
# 4. Repeat for:
#    - Individual Yearly: $60/year
#    - Team Monthly: $40/month
# 5. Set up webhooks:
#    - Developers → Webhooks → Add Endpoint
#    - URL: https://yourdomain.com/webhooks/stripe
#    - Events: customer.subscription.updated, customer.subscription.deleted, checkout.session.completed
#    - Copy Signing Secret (whsec_...)
# 6. Add keys to .env

# ======================================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# ======================================================================================

# Before launching to real users:

# [ ] RESEND_API_KEY set and domain verified
# [ ] BRIEF_FROM_EMAIL using verified domain
# [ ] Database migration applied (flask db upgrade)
# [ ] AllSides ratings seeded (flask seed-allsides)
# [ ] Generated test brief successfully (flask generate-brief)
# [ ] Sent test email (flask test-brief-email)
# [ ] Received email and HTML renders correctly (mobile + desktop)
# [ ] Scheduler running (check logs)
# [ ] Blueprints registered (check /brief route works)
# [ ] Admin interface accessible (/admin/brief)
# [ ] Magic links working (test subscribe flow)
# [ ] Unsubscribe working (test unsubscribe link)
# [ ] Timezone delivery tested (create subscriber in different TZ)
# [ ] Coverage analysis displaying correctly
# [ ] Sensationalism badges showing
# [ ] Discussion CTAs linking correctly
# [ ] Methodology page accessible
# [ ] BILLING_ENFORCEMENT_ENABLED=false for soft launch
# [ ] Stripe test mode configured (if doing paid immediately)
# [ ] Monitoring set up (logs, error tracking)
# [ ] Backup strategy in place
# [ ] SSL certificate valid
# [ ] Rate limits configured (Resend: 100/day free tier)

# ======================================================================================
# TROUBLESHOOTING
# ======================================================================================

# Emails not sending:
# - Check RESEND_API_KEY is correct
# - Verify domain in Resend dashboard
# - Check logs/email.log for errors
# - Test with: flask test-brief-email your@email.com

# Brief not generating:
# - Check OPENAI_API_KEY or ANTHROPIC_API_KEY set
# - Ensure trending topics exist: flask test-topic-selection
# - Check logs/brief.log for errors
# - Run manually: flask generate-brief

# Scheduler not running:
# - Check app startup logs
# - Verify APScheduler initialized
# - Run: flask shell -> from app.scheduler import scheduler; scheduler.running

# Coverage analysis missing:
# - Run: flask seed-allsides
# - Check: flask shell -> from app.models import NewsSource; NewsSource.query.filter(NewsSource.political_leaning.isnot(None)).count()
# - Should return 21 (number of sources)

# Database errors:
# - Run: flask db upgrade
# - Check DATABASE_URL is correct
# - Verify PostgreSQL running

# ======================================================================================
